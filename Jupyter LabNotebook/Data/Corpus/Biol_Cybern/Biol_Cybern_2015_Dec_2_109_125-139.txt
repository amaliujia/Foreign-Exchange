Introduction
The world is analogue, but computation is digital. The process that bridges this gap is known as the sampling process and has been instrumental to the digital revolution of the past 60 years. Without the sampling process, we could not convert real-life signals in digital form, and without digital samples, we could not use computers for digital computation. The sampling process is also ubiquitous in that it is present in any mobile phone or digital camera but also in sophisticated medical devices like MRI or ultrasound machines, in sensor networks and in digital microscopes just to name a few examples.


Over the last six decades, our understanding of the conversion of continuous-time signal in discrete form has been heavily influenced by the Shannon–Whittaker–Kotelnikov sampling theorem (Shannon ; Whittaker ; Kotelnikov ; Unser ) which showed that the sampling and perfect reconstruction of signals are possible when the Fourier bandwidth or spectrum of the signal is finite. In this case, the signal is said to be bandlimited and must be sampled at a rate (Nyquist rate) at least twice its maximum nonzero frequency in order to reconstruct it without error.

We are so used to this approach that we tend to forget that it comes with many strings attached. First of all, there are no natural phenomena that are exactly bandlimited (Slepian ). Moreover, we tend to forget that the Shannon sampling theorem provides sufficient but not necessary conditions for perfect reconstruction. In other words, this theorem does not claim that it is not possible to sample and reconstruct non-bandlimited signals. It is therefore incorrect to assume that the bandwidth of a signal is related to its information content. Consider for instance the function shown in Fig. a. This is a stream of short pulses and appears in many applications including bio-imaging, seismic signals and spread-spectrum communication. If the pulse shape is known a priori, the signal is completely determined by the amplitude and location of such pulses. If there are at most  pulses in a unit interval, then the signal is completely specified by the knowledge of these  parameters per unit of time. Assume now that the duration of the pulses is reduced but that the average number of pulses per unit interval stays the same. Clearly, the information content of the signal is not changing (still  parameters per unit of time); however, its bandwidth is increasing (bandwidth increases when the support of a function decreases).

Consider, as second example, the signal shown in Fig. c. This is given by the sum of a bandlimited signal with a step function. Clearly, the step function has only two degrees of freedom: the discontinuity location and its amplitude. So, its information content is finite. The bandlimited function has a finite number of degrees of freedom per unit of time since it is fully determined by its samples at points spaced by the sampling period (given by the inverse of the Nyquist rate). We thus say that they both have a finite rate of innovation. However, the combination of these two functions leads to a signal with infinite bandwidth (see Fig. d). Now, if we were to relate the information content of the signal to its bandwidth, we would conclude incorrectly that this signal has an infinite rate of information since it requires an infinite sampling rate for perfect reconstruction. Therefore, bandwidth and information content are not always synonyms.

A first attempt to reconcile these two notions: sampling rate and information content was made in Vetterli et al. (). Here, they introduced a new class of signals called signals with finite rate of innovation (FRI) which includes both bandlimited signals and the non-bandlimited functions discussed so far. They went on showing that classes of FRI signals can be sampled and perfectly reconstructed using an appropriate acquisition device. These results have then be extended to include more classes of acquisition devices (Dragotti et al. ; Seelamantula and Unser ; Asl et al. ; Tur et al. ; Urigüen et al. ) and more classes of signals (Maravić and Vetterli ; Berent et al. ; Chen et al. ). FRI sampling theory has also had impact in various applications (Baboulaz and Dragotti ; Poh and Marziliano ; Tur et al. ; Kandaswamy et al. ) and here we focus on an application in neuroscience.Examples of signals with FRI. When the shape of the pulse is known, the signal depends only on the amplitude and location of such pulses

Nyquist rate versus information rate. The signal  depicted in part a is bandlimited as shown in part b. The sum of  with a step function lead to a signal  with infinite bandwidth as shown in part c and d




The paper is organised as follows. In the next section, we define FRI signals and give some examples. Section  presents the framework for sampling and reconstructing some classes of FRI signals. Specifically, we show how to sample and perfectly reconstruct a stream of Diracs and what are the conditions that the acquisition device has to satisfy. We also extend this framework to the case of streams of decaying exponentials and present some denoising strategies. Section  presents an algorithm to reconstruct streaming signals where there is no clear separation between consecutive bursts of spikes. Section  describes an application of this theory to monitor neural activity from two-photon calcium images. Finally, conclusions are drawn in Sect. .

Notations
For , where  is the Hilbert space of finite-energy functions, the Fourier transform of  is denoted by  and is given by . If  is complex-valued,  denotes its complex conjugate. The Hermitian inner product is . The indicator function is denoted by  and is given by  if , and  if .  denotes the Kronecker delta, which is defined as  if  and 0 otherwise.  and  denote the floor and ceil functions.

Finite rate of innovation signals
Classical sampling theorems state that any bandlimited function  such that , can be perfectly recovered from its samples  if the sampling rate  is greater than or equal to twice the highest frequency component of , that is, . Moreover, the original signal can be perfectly reconstructed as follows:where . If  is not bandlimited, sampling with an ideal lowpass filter () and reconstruction applying () provides a lowpass approximation of . This is the best approximation in the least square sense of  in the space spanned by  (Unser ). However, it is an approximation, and perfect reconstruction of the original signal is not achieved. We also note that signals defined as in () are completely specified by the knowledge of a new parameter  every  seconds.

Based on this observation, consider now a new class of signals that extend the one in () (Vetterli et al. ):where  is a set of known functions. We note that, since  are known, signals in () are uniquely determined by the set of parameters  and . Introducing a counting function  that counts the number of degrees of freedom in  over the interval , we define the rate of innovation  as follows (Vetterli et al. ; Dragotti et al. ; Blu et al. ; Urigüen et al. ):and signals with a finite  are called signals with a finite rate of innovation (FRI).

It is of interest to note that bandlimited signals fall under this definition. Therefore, one possible interpretation is that it is possible to sample them because they have a finite rate of innovation (rather than because they are bandlimited). Examples of FRI signals which are not bandlimited and which are of interest to us includeStream of pulses: . For instance, stream of decaying exponentials:  which are a good fit for calcium transient signals induced by neural activity in two-photon calcium imaging. Figure a, b are examples of such signals.

Piecewise sinusoidal signals (see Fig. c): 

Stream of Diracs (see Fig. d): 



Sampling scheme
Consider the typical acquisition process as shown in Fig. . This is usually modelled as a filtering stage followed by a sampling stage. The filter accounts for the modifications that the analogue signal  experiences before being sampled. It may model an anti-aliasing filter or it might be due to the distortion introduced by the acquisition device, for example, in the case of a digital camera the distortion due to the lens. Filtering signal  with  and retrieving samples at instants of time  is equivalent to computing the inner product between  and . Specifically, the filtered signal is given byMoreover, sampling  at regular intervals of time  leads toAcquisition process



The function  is called the sampling kernel. In order to guarantee perfect reconstruction of the signal , the sampling kernel and the input signal have to satisfy some conditions. The literature presents a variety of kernels that can be used to achieve perfect reconstruction of FRI signals. Here, we will focus on exponential reproducing kernels since they offer the best flexibility and resilience to noise.Exponential reproducing property: Any function  that together with its shifted versions can reproduce exponential functions of the form  with  and : 

The exponential reproduction property is illustrated in Fig.  for two different kernels that reproduce different exponentials. In both cases, the kernels are of compact support. The advantage of such kernels is that the summation in () can be truncated and still have a region in time where the exponential functions are perfectly reproduced. In general, the exponentials  are perfectly reproduced when the summation is computed for . Let  be the support of , that is,  for . If the summation is truncated to , it follows that the perfect reproduction of the exponential functions holds for .Two different kernels that reproduce exactly different exponentials. The first row illustrates the reproduction of two real exponential functions with the kernel , shown in a. The second row illustrates the reproduction of two complex exponentials with the kernel , shown in d. In e and f, only the real part of the exponentials is shown (). The thin lines represent the shifted and weighted kernels, the thick line represents their sum and the dashed line the true exponential. Note that both kernels are of compact support. The summation in () is truncated which leads to the border effects in b, c, e and f




Exponential reproducing kernels
For the sake of clarity, in what follows, we restrict the analysis to the case where the parameter  in () is purely imaginary, that is  for , where . This analysis can easily be extended to the more general case where  has nonzero real and imaginary parts, or is purely real.

A function  together with a linear combination of its shifted versions reproduces the exponentials  as in () if and only if it satisfies the generalised Strang-Fix conditions:where ,  and  is the Fourier transform of  (Strang and Fix ; Unser and Blu ; Urigüen et al. ). A family of functions that satisfy these conditions are the exponential B-splines, also named E-splines. These functions are constructed through the convolution of elementary zero order E-splines, where each elementary function reproduces a particular exponential . The Fourier transform of a zero order E-spline that reproduces the exponential  is given byFigure  illustrates the Fourier transform of zero order E-splines for two different values of the parameter .Absolute value of the Fourier transform of zero order E-splines given by (). If the parameter  is equal to zero, the E-spline corresponds to the sinc function. For  purely imaginary, the Fourier transform of the E-spline is a shifted version of the sinc function



The corresponding E-spline that reproduces the set of exponentials  is obtained as followswhere . Thus, the Fourier transform of  is given byE-splines have compact support  and have  continuous derivatives. It can be shown that any function that reproduces the set of exponentials  can be expressed as the convolution of another function  with the corresponding E-spline that reproduces these exponentials, that is,  and  satisfies  for all (Unser and Blu ; Delgado-Gonzalo et al. ). It is also true that if  reproduces a set of exponentials, this property is preserved through convolution. Letfor  such that . The function  also reproduces the same set of exponentials. This is easy to verify since  also satisfies the Strang-Fix conditions.

Sampling with an exponential reproducing kernel
The choice of purely imaginary parameters  leads to an important family of sampling kernels. These design parameters directly determine the information of the input analogue signal  that we acquire and allow us to perfectly reconstruct the input signal from the discrete samples  for some classes of signals. Specifically, the different  correspond to the frequencies of the Fourier transform of  that we are able to retrieve from the only knowledge of samples . It can be shown that if parameters  are real or appear in complex conjugate pairs, the corresponding E-spline is real. We thus impose that for all  that are nonzero, their complex conjugates are also present in . If parameters  in vector  are sorted in increasing order of , we have that .

Let us assume that function  is localised in time and thus only  samples  are nonzero. Let  be the sequence obtained by linearly combining samples  with the coefficients  from (), that is, . We have thatwhere  follows from (),  from the linearity of the inner product and  from the exponential reproduction property. The quantity  therefore corresponds to the Fourier transform of  evaluated at . Since we have imposed , we also have that .


Computation of  coefficients
We have established the properties that a function  has to satisfy in order to reproduce exponentials, which are given by the Strang-Fix conditions. Moreover, we have seen the importance of the E-splines since they allow us to obtain samples of the Fourier transform of the input signal. We now show how to obtain the coefficients  in () required to reproduce the exponential functions , and that are used to obtain the sequence  in (). These coefficients are given bywhere  is chosen to form with  a quasibiorthonormal set (Dragotti et al. ). This includes the particular case where  is the dual of , that is, . The introduction of  is a technicality that is needed in order to show where the coefficients  come from, but we do not need to work with this function. From (), we can express  in terms of  by applying a change of variable :If we plug this expression in (), we can derive an expression to compute  for each :which is valid for any value of . Let , we have thatwhere  follows from the Possion summation formula and  from the fact that the Fourier transform of  is equal to the Fourier transform of  shifted by . Since  satisfies the Strang-Fix conditions, from () and () it follows thatThe dots in Fig. b illustrate the values  that are used in the computation of the different  for an E-spline with . Note that the generalised Strang-Fix conditions () impose some constraints on the choice of  since we have to guarantee that . From () and Fig. , it is clear that each  introduces zeros at locations , where , we thus have to guarantee that for all pairs of distinct  we have . In Fig. b, it can be appreciated that  is nonzero for all , and that the locations  and  are zero since the curve in dB tends to .E-spline of order  and . Note that the support in time is equal to  and quickly decays to zero. This E-spline reproduces the exponentials in Fig.  among others. Parameters  are purely imaginary or equal to zero; purely imaginary  appear in complex conjugate pairs. a illustrates the shape of the E-spline in time and b in frequency (expressed in dB). The dots in b represent the locations at which the Fourier transform of  is sampled in order to compute the  coefficients as in (). c is a representation of the complex values 




From () and (), we can compute the  coefficients for our choice of  and any value of . By combining these coefficients with , the exponentials  are perfectly reproduced as shown in Fig. .

Approximate reproduction of exponentials
The generalised Strang-Fix conditions () impose restrictive constraints on the sampling kernel. This becomes a problem when we do not have control or flexibility over the design of the acquisition device. Recent publications (Urigüen et al. ; Dragotti et al. ) show that these conditions can be relaxed and still have a very accurate exponential reproduction, which is the property we require in order to reconstruct the analogue input signal. The first part of the Strang-Fix conditions, that is , is easy to achieve, but the second part is harder to guarantee when we do not have control over the sampling device.

If the sampling kernel does not satisfy the generalised Strang-Fix conditions, the exponential reproduction property () cannot be satisfied exactly. We thus have to find the coefficients  that better approximate the different exponentials :There are various options to compute these coefficients, but a good and stable approximation is obtained with the constant least squares approach (Urigüen et al. ). If the Fourier transform of the sampling kernel is sufficiently small at , , the  coefficients are given byGaussian filters are good candidates for this approach since they are smooth and the shape in time is very similar to the E-splines (see Fig. a). The Fourier transform of such filters is given byIt is clear that the filter is nonzero at , , however, as can be appreciated from Fig. a, the attenuation at these frequencies is very strong. This makes the exponential reproduction very accurate as illustrated in Fig. b, c.Gaussian sampling filter with  and approximate exponential reproduction. a Fourier transform of Gaussian function compared to a first order E-spline that reproduces frequencies  and . The zoom-in box shows the region where the E-spline is zero (); the Gaussian function has a negligible amplitude. b–d are examples of exponential reproduction with the Gaussian filter. As in Fig. , the thin lines represent the shifted and weighted versions of  (which in this case is the Gaussian function), the thick line their sum, and the dashed line the true exponentials



In the case of the Gaussian filter, we can easily obtain the  coefficients of the exponentials to be reproduced since we have an analytical expression for its Fourier transform. When an analytic expression is unknown, we can still apply this approach since we only need knowledge of the transfer function of the acquisition device at frequencies . The  coefficients are then given by ().

The approximate Strang-Fix framework is therefore very attractive since it allows us to use the theory discussed so far with any acquisition device.

Perfect reconstruction of FRI signals
In the previous section, we have seen some properties of exponential reproducing kernels. We have also seen that if the sampling kernel satisfies the exponential reproducing property, we can obtain some samples of the Fourier transform of the input analogue signal from the measurements  that result from the sampling process. We now show how this partial knowledge of the Fourier transform can be used to perfectly reconstruct some classes of band unlimited signals.

Perfect reconstruction of a stream of Diracs
We assume that the input signal is a stream of Diracs: , and that the sampling kernel  satisfies the exponential reproduction property for a choice of  such that , where  for . We further impose the frequencies  to be equispaced, that is , and to be symmetric, that is . We thus have  and .

Since  is a sum of Diracs, we have that the Fourier transform is given by a sum of exponentials:

This is clearly a band unlimited signal. We now consider the sequence  that is obtained by linearly combining samples  with the coefficients  from the exponential reproducing property (). From (), we have that  and therefore:where  and . Note that we have also applied the fact that the frequencies can be expressed as . The perfect recovery of the original stream of Diracs, that is, the estimation of the locations  and the amplitudes  of the  Diracs, is now recast as the estimation of parameters  and  from the knowledge of values . The problem of estimating the parameters of a sum of exponentials from a set of samples arises in a variety of fields and has been analysed for several years by the spectral estimation community (Pisarenko ; Paulraj et al. ; Schmidt ). One way to solve it is by realising that the sequence  given as in () is the solution to the following linear homogeneous recurrence relationSee section “Linear homogeneous recurrence relations with constant coefficients” of Appendix for a description of this type of homogeneous systems and their solutions. Note that coefficients  are unknown, but can be obtained from the following linear system of  equations:It can be shown that, if the  parameters  in () are distinct, which is a direct consequence of the fact that all the delays  are different, the Toeplitz matrix in the left-hand side of () is of rank , and therefore, the solution is unique (see section “Rank deficiency of Toeplitz matrix” of Appendix for a proof on the rank of this matrix). As shown in section “Linear homogeneous recurrence relations with constant coefficients” of Appendix, the parameters  are obtained from the roots of the polynomial . Once the parameters  have been obtained, the amplitudes  of the sum of exponentials can be directly retrieved from () by solving the associated least squares problem. From  and , we can then compute  and . The stream of Diracs is thus perfectly recovered. In the literature, this approach is known as Prony’s method or the annihilating filter method (Stoica and Moses ).

The system of equations () requires at least  consecutive values . Recall that the sequence  is obtained as follows , with , where  is the number of exponentials reproduced by the sampling kernel. We thus have a lower bound on the number of exponentials that the sampling kernel has to reproduce: . The perfect reconstruction of a stream of Diracs is summarised in the following theorem.

Theorem 1
Consider a stream  of K Diracs: , and a sampling kernel  that can reproduce exponentials , with , and . Then, the samples defined by  are sufficient to characterise  uniquely.

Figure  illustrates the entire sampling process. Note that, since the sampling kernel is of compact support and the stream of Diracs is localised in time, there are only a small number of samples  that are nonzero. From Fig. e, it is clear that the signal is not bandlimited. Furthermore, in the classical sampling setup, in order to sample a continuous-time signal at rate  Hz, an anti-aliasing filter that sets to zero  for  has to be applied before acquisition. The FRI framework does not impose this stringent condition since the sampling kernel is not necessarily equal to zero for all .Sampling of a stream of Diracs and perfect reconstruction.  Diracs sampled with an E-spline of order  which corresponds to the critical sampling rate (). a is the continuous-time stream of Diracs, b the sampling kernel  where  is an E-spline of order  that reproduces the exponentials illustrated in c. d is the continuous-time signal  and the corresponding discrete samples . In e,  is obtained from () and  from samples  linearly combined with coefficients . f is the reconstructed stream of Diracs from the sequence . The original signal is perfectly reconstructed



Perfect reconstruction of a stream of decaying exponentials
Streams of Diracs are an idealisation of streams of pulses. Although this example may seem limited, the framework presented so far can be applied to other classes of functions that model a variety of signals. For instance, calcium concentration measurements obtained from two-photon imaging to track the activity of individual neurons can be modelled with a stream of decaying exponentials. In this model, the time delays correspond to the activation time of the tracked neuron, that is, the action potentials (AP).

Let  be a stream of  decaying exponentials, that iswhere . See Fig. a for an example of such signal. This is also an FRI signal since  is perfectly determined by a finite number of parameters: . Let us assume that  is sampled with the acquisition device described in Sect. , that is, an exponential reproducing kernel , followed by a sampling stage. We thus have that  satisfies (), and the resulting samples  can be expressed as the inner product between  and  as in ().

Let us also assume that the reproduced exponentials  can be expressed as , with . It can be shown that sampling the signal in () with  and computing the following finite differencesis equivalent to the sequence that would result from sampling the stream of Diracs  with the following kernelwhere  is a zero order E-spline with parameter  (Oñativia et al. ). Note that  is the exponent in (). We thus have thatSince convolution preserves the exponential reproduction property,  reproduces the same exponentials as . Thus, we can find the coefficients  such thatWe now have all the elements to perfectly reconstruct the stream of decaying exponentials  from samples , that is, estimate the set of pairs of parameters . By combining the sequence  with coefficients , we obtain exactly the same measurements  as in ():where  and . We can therefore apply Prony’s method to this sequence and obtain the parameters of interest. Figure  illustrates the perfect reconstruction of a stream of  decaying exponentials.Sampling of a stream of decaying exponentials and perfect reconstruction. Since  is an infinite duration signal, samples  are nonzero for , for some  that depends on the location of the first decaying exponential. However, if the number of decaying exponentials is finite, the number of nonzero samples  is also finite since they are equivalent to sampling a stream of Diracs with a compact support kernel. a Input signal, , b filtered and sampled signal, c reconstructed signal



FRI signals with noise
The acquisition process inevitably introduces noise making the solutions described so far only ideal. Perturbations may arise in the analogue and digital domain. We model the noise of the acquisition process as a white Gaussian process that is added to the ideal samples. The noisy samples are therefore given bywhere  are the ideal noiseless samples from () and  are i.i.d. Gaussian random variables with zero mean and variance . In order to have a more robust reconstruction, we increase the number of samples  by making the order  larger than the critical rate .

The denoising strategies that can be applied to improve the performance of the reconstruction process come from the spectral analysis community, where the problem of finding sinusoids in noise has been extensively studied. There are two main approaches. The first, named Cadzow denoising algorithm, is an iterative procedure applied to the Toeplitz matrix constructed from samples  as in (). Let us denote by  this matrix. By construction, this matrix is Toeplitz, and in the noiseless case, it is of rank . The presence of noise makes this matrix be full rank. The Cadzow algorithm (Cadzow ) looks for the closest rank deficient matrix which is Toeplitz. At each step, we force matrix  to be of rank  by computing the singular value decomposition (SVD) and only keeping the  largest singular values and setting the rest to zero. This new matrix is not Toeplitz anymore, we thus compute a new Toeplitz matrix by averaging the diagonal elements. This last matrix might not be rank deficient, and we can thus iterate again. The next step is to solve equation (). This is done computing the total least squares solution that minimises  subject to , where  is an extended version of the vector in () and has length . If this vector is normalised with respect to the first element, we have that the following  elements correspond to the coefficients  in (). This approach has successfully been applied in the FRI setup in (Blu et al. ).

The second approach is based on subspace techniques for estimating generalised eigenvalues of matrix pencils (Hua and Sarkar , ). Such approach has also been applied in the FRI framework (Maravić and Vetterli ). This method is based on the particular structure of the matrix , which is Toeplitz and each element is given by a sum of exponentials. Let  be the matrix constructed from  by dropping the first row and  the matrix constructed from  by dropping the last row. It can be shown that in the matrix pencil  the parameters  from () are rank reducing numbers, that is, the matrix  has rank  for  and rank  otherwise. The parameters  are thus given by the eigenvalues of the generalised eigenvalue problem .

Further variations of these two fundamental approaches have been proposed recently. See for example Tan and Goyal (), Erdozain and Crespo (), Hirabayashi et al. ().

Sampling streaming FRI signals
In the previous section, we have seen how to sample and reconstruct a set of  Diracs. We now consider the case where we have a streaming signal:

If the stream is made of clearly separable bursts, we can apply the previously described strategy by assuming that each burst has a maximum number of spikes. However, when this separation cannot be made because of the presence of noise, or due to the nature of the signal itself, this strategy is not valid. The infinite stream presents an obvious constraint due the number of parameters that have to be recovered. We have seen that the order of the sampling kernel, , and its support are directly related to the number of parameters to be estimated. However, we cannot increase  indefinitely. In order to handle this type of signals, we thus consider a sequential and local approach (Oñativia et al. ).

Sliding window approach
We assume that  has a bounded local rate of innovation of , that is, for any time window of duration  there are at most  Diracs within the window. Since each Dirac has two degrees of freedom, location and amplitude, the rate of innovation is . We analyse sequentially the infinite stream with a sliding window that progresses in time by steps equal to the sampling interval . Let the -th window cover the following temporal intervalwhere  and  is the number of samples that are processed for each position of the sliding window. The acquisition device is the same as in the previous section: the sampling kernel is given by  and . In order to have a causal filter , that is  for , we impose the support of  to be , where  if  is an E-spline of order . The support of  is therefore . Consequently, a Dirac located at  influences  samples . The indices corresponding to these samples are given byWhen we process the stream sequentially, there are border effects due to the fact that we only process  samples at a time. Diracs located just before the sliding window influence samples within the window, and the Diracs inside the observation window which are close to the right border influence samples outside the window. These effects are illustrated in Fig. . However, if the sliding window is big enough, there are a good number of positions of the sliding window that will fully capture each individual Dirac and therefore lead to a good estimate of its amplitude and location. In the noiseless case, we can detect if we are in the presence of these border effects or if there is no border effect and therefore the reconstruction can be exact. Nonetheless, in the presence of noise, we cannot guarantee perfect reconstruction.Border effects with the sliding window approach. In this example,  and . a A nearby Dirac located before the observation window  influences samples  of the window. b A Dirac inside the window but close to the right border generates nonzero samples outside the window



For this reason, the sequential algorithm works in two steps: first, it estimates the locations for each position of the sliding window; second, it analyses the consistency of the retrieved locations among different windows. The -th window processes samples . Let  be the set of estimated locations within the -th window. When the observation window is at position , we know that Diracs located at  cannot have any influence on the current samples. We can therefore analyse the consistency of the locations up to . Figure a shows the retrieved locations for different positions of the sliding window, where the horizontal axis corresponds to the window index, , and the vertical axis to the locations in time, that is, for a given window index, each dot corresponds to an estimate of the set . Consistent locations among different windows appear as horizontally aligned dots. The shaded area represents the evolution in time of the observation window: for a given index , the vertical cross section of the shaded area represents the time interval  that is seen by this window. This consistency can be analysed by building a histogram of all the estimated locations up to a given time. This is illustrated in Fig. b. The Diracs are then estimated from the peaks of this histogram.Noisy scenario with SNR = 15 dB,  and . The maximum rate of innovation of the streaming signal is . a Plot of the sequentially estimated locations, the horizontal axis indicates the index of the sliding window and the vertical axis the location in time. b Histogram of the locations shown in a. Horizontally aligned dots in a lead to peaks in the histogram in b




Application to neuroscience
To understand how neurons process information, neuroscientists need accurate information about the firing of action potentials (APs of spikes) by individual neurons. We thus need techniques that allow to monitor large areas of the brain with a spatial resolution that distinguishes single neurons and with a temporal resolution that resolves APs. Of the currently available techniques, only multiphoton calcium imaging (Denk et al. , ; Svoboda et al. ; Stosiek et al. ) and multielectrode array electrophysiology (Csicsvari et al. ; Blanche et al. ; Du et al. ) offer this capability. Of these, only multiphoton calcium imaging currently allows precise three-dimensional localisation of each individual monitored neuron within the region of tissue studied, in the intact brain. Populations of neurons are simultaneously labelled with a fluorescent indicator, acetoxy-methyl (AM) ester calcium dyes (Stosiek et al. ). This allows simultaneous monitoring of action potential-induced calcium signals in a plane (Ohki et al. ) or volume (Göbel and Helmchen ) of tissue. The calcium concentration is measured with a laser-scanning two-photon imaging system.

For a given region of interest (ROI) where a neuron is located, the calcium concentration is obtained by averaging the value of the pixels of the ROI for each frame. The result is a one-dimensional fluorescence sequence. We assume that when a neuron is activated, the calcium concentration jumps instantaneously, and each jump has the same amplitude . The concentration then decays exponentially, with time constant , to a baseline concentration. The one-dimensional fluorescence signal can therefore be characterised by convolving the spike train with a decaying exponential and adding noise:where the index  represents different spikes and the different  their occurrence times. Hence, the goal of spike detection algorithms is to obtain the values .


A number of methods have previously been used to detect spike trains from calcium imaging data, including thresholding the first derivative of the calcium signal (Smetters et al. ), and the application of template-matching algorithms based on either fixed exponential (Kerr et al. , ; Greenberg et al. ) or data-derived (Schultz et al. ; Ozden et al. ) templates. Machine learning techniques (Sasaki et al. ) and probabilistic methods based on sequential Monte Carlo framework (Vogelstein et al. ) or fast deconvolution (Vogelstein et al. ) have also been proposed. Some broadly used methods such as template matching or derivative-thresholding have the disadvantage that they do not deal well with multiple events occurring within a time period comparable to the sampling interval. Our spike detection algorithm is based on connecting the calcium transient estimation problem to the theory of FRI signals. The calcium concentration model in () is clearly a FRI signal, we can thus apply the techniques presented in the previous sections.

Spike inference algorithm
The spike inference algorithm is based on applying the sliding window approach presented in Sect.  combined with the reconstruction of streams of decaying exponentials presented in Sect. . One major issue of the framework presented so far is that we have assumed the number  of spikes within a time window to be known a priori. In practice, this is a value that has to be estimated.

In the noiseless case, the number of spikes can be recovered from the rank of the Toeplitz matrix constructed from samples :In the noisy case, matrix  becomes full rank. An estimate of  can still be obtained by thresholding the normalised singular values of . Let  be the singular values of  sorted in decreasing order. We can estimate  as the number of singular values that satisfy . Where  is adjusted depending on the level of noise. This approach tends to overestimate . Moreover, we never detect the  case since when noise is present we always have .
Double consistency spike search with real data. a and b show the detected locations with dots and the original spikes with horizontal lines for two different window sizes. In a, the algorithm runs estimating the number of spikes within the sliding window. In b, the algorithm runs assuming a fixed number of spikes equal to one for each position of the sliding window. c shows the joint histogram of the detected locations

Fluorescence signal and detected spikes using the double consistency approach. The spikes are detected from the peaks of the histogram in Fig. c



To overcome these inaccuracies, we make the algorithm more robust by applying a double consistency approach. We run the sliding window approach presented in Sect.  twice. First, with a sufficiently big window where we estimate  from the singular values of . Second, with a smaller window where we assume that we only capture one spike and therefore we always set . We then build a joint histogram out of all the locations retrieved from both approaches and estimate the spikes from the peaks of the histogram. This approach is illustrated in Figs.  and  with real data.

This technique is fast and robust in high noise and low temporal resolution scenarios. It is able to achieve a detection rate of 84 % of electrically confirmed AP with real data (Oñativia et al. ), outperforming other state of the art real-time approaches. Due to its low complexity, tens of streams can be processed in parallel with a commercial off-the-shelf computer.

Conclusions
We have presented a framework to sample and reconstruct signals with finite rate of innovation. We have shown that it is possible to sample and perfectly reconstruct streams of Diracs, and more importantly, streams of decaying exponentials. The latter offer a perfect fit for calcium transients induced by the spiking activity of neurons. The presented approach is sequential, and the reconstruction is local. These two features make the overall algorithm resilient to noise and have low complexity offering real-time capabilities.

The theoretical framework, where perfect reconstruction can be achieved, is also extended to the more realistic case where we do not have full control over the sampling kernel. In this case, perfect reconstruction cannot be guaranteed, but we can still reconstruct the underlying analogue signal with high precision if the sampling kernel can reproduce exponentials approximately.

Appendix
Linear homogeneous recurrence relations with constant coefficients
Let  be the linear operator with constant coefficients that establishes the following recurrence relation of order up to  when applied to a sequence :The corresponding homogeneous system is given byThis is the discrete-time version of a homogeneous linear differential equation given byBoth, the linear homogeneous differential equation () and the linear homogeneous recurrence relation () have equivalent solutions. In the continuous-time case, the functions that satisfy the homogeneous equation have the form of exponential functions. Similarly, the solution to the discrete-time version has the form of exponential sequences. The solution to () is not unique, but all the solutions have the form , where . Thus, to solve () we set , leading toDivision by  gives the th order polynomial is the characteristic polynomial of the homogeneous system. The roots of , that is, the values  that satisfy , determine the solution to (). We have that . If the  roots are distinct, the solution to the homogeneous recurrence relation is given by any linear combination of the sequences constructed from the different roots:since  and .

Rank deficiency of Toeplitz matrix
Let  be the following  Toeplitz matrix:where ,  and each element of the matrix is given by , with all  nonzero and all  distinct. The matrix  can be decomposed as follows:Since  and  are Vandermonde matrices with distinct elements, both are of rank . Therefore, if elements  are nonzero, matrix  has rank .

For appropriate functions , the Poisson summation formula is given by: .

This work was supported by European Research Council (ERC) starting investigator award Nr. 277800 (RecoSamp).

