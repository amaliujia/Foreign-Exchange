1 INTRODUCTION
Metabolomics is an emerging field of study in post-genomics, which aims at comprehensive analysis of small organic molecules in biological systems. Techniques of mass spectrometry coupled to liquid chromatography [liquid chromatography–mass spectrometry (LC–MS)] stand out as dominant methods in metabolomic experiments.

Although computational strategies have been used to filter and annotate mass peaks in LC–MS experiments (), these methods do not include the addition of external information into a mathematical model in a principled way. Recently,  put forward a proof-of-concept in which information incorporated to a probabilistic model provides better annotation (). Their Bayesian model, by means of appropriate prior distribution selection, introduces the elegant idea of using a set of known chemical reactions among candidate compounds to improve annotation, as certain combinations, detected together, would make more biochemical sense than others.

The state-of-the-art in probabilistic annotation established by  did not include an integrative computational implementation, a practical connection to public biological databases such as KEGG or MetaCyc () or a network-based output visualization schema. Therefore, our contribution is to fulfill these specific needs allowing easy access to this powerful statistical model for all metabolomic bioinformatics community.

2 RESULTS AND CONCLUSION
The platform chosen for implementation of these ideas was the well-known and established R programming environment, which incorporates a wide range of analyses including successful tools that perform preprocessing of spectral data required for metabolite annotation (Supplementary Fig. S1) (; ).

Following  brief suggestion on how their previous method could be extended to incorporate additional experimental information and metadata, we implemented modifications to the likelihood term. Expanding the likelihood function L in multiplicative independent terms allows one to account for additional orthogonal (independent) information sources: L = LN · Lrt · Liso, where subindexes N, rt and iso stand for measurement noise model, retention time error model and isotope profile error model, respectively. For a complete model’s description, we refer the interested reader to the Supplementary Material.

The main product of a probabilistic annotation is a list of compound candidates ranked by their probabilities (Supplementary Fig. S2). To easily navigate over ProbMetabs results, we display tabular and dynamic network outputs along with supporting information, which assists practitioners to ultimately decide on most parsimonious annotations instead of forcing them to simplistically rely on the top probability assignment. All mass peaks are viewed as graph’s nodes. Edges between two nodes are drawn if any candidate compound assigned to the outgoing node can be metabolized to any candidate compound assigned to the incoming node by means of a known biochemical reaction (Supplementary Fig. S3). ProbMetab is capable of producing reaction graphs and export them as standard Cytoscape input files or broadcasting the necessary graph data and attributes (colour, shapes, etc) directly to Cytoscape Desktop using RCytoscape (). This information can be easily overlaid with other widely used systems biology strategies such as correlation or partial correlation networks. If a mass spectra time-series or biological replicates are available, ProbMetab uses third-party packages integrated downstream to export correlation or partial correlation graphs, along with their intersection/difference with the reaction graph.

Alternatively, a biologist can visualize ProbMetab’s results in a simplified searchable web interface. Our package has a function that is responsible to consume an online web-service, which checks and renders the broadcast results as a web page. The visualization approach was developed taking advantage of the cytoscape.js library () and its dependencies and can be easily integrated or embedded into any html5 web application.

ProbMetab’s documentation brings two detailed case studies in which all its features are explored. Moreover, to highlight integration with downstream and upstream third-party R packages, data analysis examples mentioned are carried out from raw data, following through preprocessing until it reaches ProbMetab’s specific point of action. We used publicly available data from Trypanosoma brucei, causative agent of sleeping sickness, and an original dataset from Saccharum officinarum (sugarcane), an important biofuel source, to illustrate several points in typical metabolomics analysis sections.

The T. brucei dataset, obtained from the mzMatch.R project website, was chosen because it presents a set of metabolites identified with the aid of internal control standard compounds, being specially suited for performance evaluation. With this validation dataset, we compare the MetSamp (http://www.dcs.gla.ac.uk/inference/metsamp/) implementation from  with ProbMetab’s implementation and show that, the efficient R/c++ integrated function () had a 3-fold running time improvement over the MATLAB implementation. For both implementations, the higher probability candidate was the true identity in up to 60% of the metabolites. However, instead of reporting only the higher probability candidate identity as proposed by , we show that exporting the complete ranking in summarized visualizations, up to 90% of metabolite identities are among the top three higher probabilities. The full or filtered ranking allows the experimenter to associate the candidates with additional information present in this output and attribute the correct identity.

The sugarcane dataset was chosen to exemplify differential expression of annotated metabolites in contrasting environmental perturbation. We successfully recovered changes in a known stress response pathway (flavone and flavonol biosynthesis), showing the importance of a network-centric visualization for metabolite annotation to track metabolism changes. The benchmark dataset confirms, as preconceived by , that a probabilistic model using orthogonal data and metadata yields better automatic mass peak annotation. The perturbation dataset shows that probabilistic annotation can produce otherwise impossible interpretation for differential network connectivity.

We implemented a method to annotate compounds in a computational framework that allows the introduction of prior knowledge and additional spectral information. With the R package ProbMetab, we provide ways to summarize the results of series of analysis needed to extract information from complex high-dimensional MS data, and help the experimenter to track metabolism changes in the process of interest.

Supplementary Material
Supplementary Data
ACKNOWLEDGEMENTS
The authors thank Bruno M. Della Vecchia (USP), Dr Oscar Yanes’s team (Rovira i Virgili University) and Paul Shannon (Fred Hutchinson Cancer Research Center) for critical discussions. They thank EBI/EMBO’s courses for catalyzing cooperation among coauthors.

Funding: Microsoft Research and FAPESP (09/53161-6); FAPESP Temático grant (08/56100-5) and fellowships (10/14926-4, 12/05392-1 and 10/15417-6); CAPES through Pós-graduação em Genética FMRP-USP.

Conflict of Interest: none declared.

