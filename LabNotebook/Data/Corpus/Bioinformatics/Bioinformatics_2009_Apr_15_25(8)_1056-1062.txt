1 INTRODUCTION
During meiosis, homologous copies of the chromosomes align, and the repair of programmed double-stranded breaks in the DNA leads to recombination: the reciprocal exchange of DNA between homologs (crossovers), or the non-reciprocal modification of one homolog, using the other as a template (non-crossover gene conversion). As a consequence, the genome of each meiotic product, or ‚Äòsegregant‚Äô, is a mosaic of the two parental genotypes (). A recent study in Saccharomyces cerevisiae used the array-based genotyping methodology presented here to create a genome-wide map of crossover and non-crossover gene conversion with the highest resolution to date (Mancera et al., ).
Meiotic recombination genotyping assay. (A) Meiosis was induced in a diploid cross derived from the highly polymorphic S96 and YJM789 strains. Haploid parents and meiotic products (‚Äòsegregants‚Äô) were used for genotyping. (B) Five probes‚Äîfour S96-specific and one YJM789-specific‚Äîinterrogate a C/G SNP. When presented with S96 genomic DNA, the S96-specific probes are bright while the YJM789-specific probe exhibits reduced fluorescence intensity. For YJM789 genomic DNA, the pattern would be reversed.



Oligonucleotide microarrays provide an accurate and cost-effective means of identifying and genotyping polymorphic loci. Oligonucleotide microarray probes hybridize more efficiently to targets whose sequence is exactly complementary than to targets which only partially or imperfectly match the probes. Winzeler et al. () used this fact to identify several thousand polymorphic positions in the same two yeast strains we consider here. Since then, numerous authors have made use of these so-called ‚Äòsingle feature polymorphisms‚Äô (SFPs)‚Äîin yeast (Brem et al., ; Deutschbauer and Davis, ; Gresham et al., ; Steinmetz et al., ; Winzeler et al., ), and also in other organisms (Albert et al., ; Borevitz et al., ; Rostoks et al., ; Turner et al., ). With the exception of Brem et al. (), these authors have taken a supervised approach to the problem, training a genotyping classifier on samples of known genotype and then applying the classifier to new samples. Winzeler et al. () hybridized parental genomic DNA from each of the two strains to standard yeast expression arrays. Then, after preprocessing, analysis of variance (ANOVA) was used to identify probes whose observed log-scale fluorescence intensities appeared to be better fit by a model with two means than by a model with one. Such probes were deemed to be SFPs. To genotype segregants from a cross, a posterior probability was computed using the estimated Gaussian densities from the parental-array ANOVA, plus a uniform prior on the two genotypes:


Variants on this procedure soon emerged. The 1- versus 2-mean ANOVA is equivalent to a two-sample t-test for difference in means, and Borevitz et al. () proposed an alternative t-test for identification of SFPs, using the ad hoc moderated t-statistic of SAM (Tusher et al., ). Brem et al. ()‚Äîwhose data included hybridizations from numerous segregants of unknown genotype, as well from parental samples of known genotype‚Äîfurther augmented this approach: using parental data, candidate SFPs were identified on the basis of a high moderated t-statistic. Then, known parental genotype labels were temporarily set aside, and the combined parental and segregant data were subjected to k-means clustering (k = 2). Candidate SFPs were only retained if the parental samples were correctly separated by the resulting clusters. Further, Brem et al. estimated the Gaussian densities required in () from all data in the clusters, rather than only from parental observations of known genotype.

The more recent, multivariate approach of Gresham et al. ()‚Äîdesigned for high-density tiling microarrays‚Äîis quite different: the authors considered the set of probes which interrogate a given position, and they modeled the decrease in fluorescence intensity caused by a SNP as a function of (i) the SNP's position within each probe, (ii) known response of the probes to reference sequence and (iii) various aspects of the probes' base composition. Their algorithm, SNPscanner, was trained on a set of ‚Äòhigh-quality‚Äô known SNPs to produce two predictions for probe set behavior: one which corresponds to reference sequence, and the other, to sequence with a variant base at the given position. Observed behavior on new arrays was compared with the two predictions, and genotype was assigned on the basis of which model fits best.

In the remainder of this article, we introduce ssGenotyping (ssG) as an alternative to SNPscanner, and show that it provides both more specific and more sensitive genotyping in the context of a meiotic recombination dataset. In addition, we use the comparison between the methods to illustrate two points which are important for successful array-based genotyping in any context: (i) the extent to which probe behavior‚Äîcross-hybridization behavior, in particular‚Äîis sensitive to genomic background, and (ii) the ability of predictive models to describe probe behavior in a complex setting.

2 APPROACH AND METHODS
2.1 Motivation
We developed the ssG algorithm to genotype over 50 000 polymorphic markers in 220 segregants‚Äî51 wild-type tetrads and 5 msh4 deletion mutant tetrads‚Äîresulting from the sporulation of a diploid cross of two substantially diverged strains of S.cerevisiae (see Supplementary Methods). One strain, S96, is isogenic with the common laboratory strain S288c, for which the whole-genome sequence is known; the other, YJM789, is a clinical isolate that has recently been sequenced (Gu et al., ; Wei et al., ). The segregation patterns of the markers provided detailed information about local recombination rates, patterns of crossover interference, and the size and spatial distribution of gene conversion events (Mancera et al., ).

Genomic DNA from the segregants as well as from 25 parental samples was hybridized to Affymetrix tiling microarrays which provide dense coverage of the reference S288c genome, typically at 4 bp resolution. The arrays also include probes which interrogate YJM789 sequence, at positions where this sequence differs from the S288c reference (see Supplementary Methods). Comparison of the aligned sequences from the two strains revealed ‚âà61 000 putative polymorphisms‚Äîsingle nucleotide polymorphisms (SNPs), insertions or deletions‚Äîof which ‚âà52 000 were interrogated by distinct sets of one or more uniquely mapping probes. Given the tiling design, the vast majority of these polymorphisms were interrogated by sets of overlapping probes (Supplementary Figure S1). We therefore selected a multivariate approach which is able to accommodate correlation arising from the overlap among the probes in a probe set ().
A probe set associated with a SNP (ID 180) on chromosome I. (A) Behavior of the eight probes in the set, ordered by genomic position. S288c-specific probes (e.g. 1) produce higher intensity on S96 parental arrays (red), while YJM789-specific probes (e.g. 2) are brighter on YJM789 parental arrays (blue). Note that some probes (3 and 5) fail to distinguish between the parental data, and that within-class variance is not constant. (B) Projection of eight-dimensional data into the first two principal components (PCs). Each point in B corresponds to one connected set of segments in A. Data form clear clusters, although parental behavior is not fully representative of segregant behavior. PC1 aligns with a vector whose entries are ¬±1 for informative probes‚Äîwith sign determined by the allele to which the probe is specific‚Äîand 0 for the two uninformative probes (r = 0.97). Projection in this direction corresponds to comparing average log intensities from informative probes and ignoring the two non-responders. (C) Residual pair wise correlation, after centering within class. There are blocks along the diagonal‚Äîcorresponding to consecutive, overlapping probes‚Äîwith significant positive and negative correlation.



2.2 ssG: raw genotype calls
 shows that (i) segregant data, as one might expect, typically produce two distinct clusters, and (ii) parental data are informative, but not always representative of the segregants with which they share a genotype. With both points in mind, the ssG algorithm fits a single model to the combined parental and segregant data, using known genotype labels for the parents and soft class assignments for the segregants. More concretely, the preprocessed log-scale intensity data from the set of d probes which interrogate a given polymorphism‚Äîi.e. which overlap the polymorphism in at least one of their 25 bases‚Äîmay be represented with vectors X1,‚Ä¶, Xn, each of dimension d. To assign genotypes to the segregants, we fit a Gaussian mixture model to all arrays simultaneously, computing maximum likelihood estimates via the expectation-maximization (EM) algorithm (Dempster et al., ). The algorithm proceeds as follows:

Let Yi ‚àà {1, 2} denote the genotype of sample i at the polymorphism in question. If A, B and S denote the indices corresponding to the two parental types and the segregants, respectively, then Yi is known whenever i ‚àà A‚à™B, but unknown for i ‚àà S. We postulated that X|Y ‚àº ùí©d(ŒºY, Œ£Y), and that (Xi, Yi) was independent of (Xi‚Ä≤, Yi‚Ä≤) for i ‚â† i‚Ä≤. Importantly, we did not require Œº1j to differ from Œº2j for every j‚Äîreflecting the fact that the marginal behavior of some probes in a probe set may not distinguish between the two genotypes. Further, Œ£1 and Œ£2 were not assumed to be equal nor diagonal.  provides a typical example of the marginal and joint behavior of probes in a eight-probe set, and shows that both of these issues are relevant.

In the Gaussian mixture case, the M step of the EM algorithm‚Äîwhich maximizes an estimate of the conditional expectation of the log likelihood‚Äîonly requires estimates of P(Yi = g|Xi) for all i ‚àà S. To initialize these conditional probabilities (hereafter denoted pig), we applied a simple clustering algorithm‚Äîk-means, with the two clusters seeded with parental observations‚Äîto the combined parental and segregant data, and then set each p(0)ig to either 0 or 1, depending on the outcome of this clustering. (Alternately, one could begin with the E step and initialize the  and  using the parental data; this strategy produced identical results.) Defining p¬∑g ‚â° ‚àëipig, it is straightforward to show that the M step's objective function is maximized in Œºg by

i.e. by a weighted average of the observations, with weights determined by (estimated) conditional probability of membership in class g. The objective function is maximized in Œ£g by

i.e. by a weighted version of the standard empirical covariance estimate. In the meiotic recombination context, it is natural to assume that, for a given polymorphism, a segregant is equally likely to inherit either of the two parental alleles, so we fixed œÄ1 = œÄ2 = 0.5. In other contexts, œÄ1 and œÄ2 can easily be estimated. To begin the next iteration, we updated pig for all i ‚àà S, by

and continued until a convergence criterion was met. Here, œÜ(¬∑; Œº, Œ£) denotes the density of a multivariate normal distribution with mean Œº and covariance matrix Œ£. We also define  to be . Final assignment of genotype for the segregants was then obtained by comparing pi1 and pi2. This is analogous to (), although the two distributions are now multivariate, and the parameter estimates are derived from a combination of the parental and offspring data rather than from parental data alone. The contrast between the two fit types (semi-supervised versus supervised parental-only) can be substantial, as illustrated in .
Parental-only (dashed) versus semi-supervised (solid) fitted distributions for two probe sets, with projection into the first two PCs for visualization. Contours represent ¬±2 SDs in each PC. Clusters are well separated in (A) but not (B). For both probe sets, assuming Œ£1 = Œ£2 is not justified for either fit type. The parental-only fits do not describe segregant behavior well, particularly for (A). For (B), the supervised parental-only fits exaggerate the degree of separation between the classes‚Äîpotentially leading to retention of an error-prone probe set.



2.3 ssG: filtering
After fitting distributions to all probe sets, we applied quality filtering at the (i) array, (ii) polymorphism and (iii) individual call levels. Genotype calls for four arrays implied a huge increase (more than an order of magnitude above what was typically observed) in genotype switching along the associated segregants' chromosomes, so these four arrays were set aside. The distributional estimates  and  returned by the EM algorithm admit natural polymorphism- and call-level filtering as well.  shows that the distributions were not always well separated; further, due to errors in genomic sequence or alignment, some putatively polymorphic loci may not actually be polymorphic. We used  and  to compute expected misclassification rates, and set aside probe sets for which this rate was too large (&gt; 1%). Finally, individual calls which were intermediate with respect to  and ‚Äîproducing pig which were too far from both 0 and 1‚Äîwere removed. Individual calls with unambiguous pig but which were nonetheless outliers with respect to their assigned class were also removed. (See Supplementary Methods for additional details.)

Supplementary Figure S2 depicts a further problem found in a small fraction (0.7%) of probe sets: behavior which is inconsistent with the biological and statistical models for meiotic recombination. Such behavior may be due to cross-hybridization from sequence at an unlinked locus, or to unanticipated translocations in our S96 parental strain, relative to the S288c reference sequence. To address this issue, we computed auxiliary fits for each probe set‚Äîby using only parental or only offspring data, or by fitting more than two clusters‚Äîand compared these fitted distributions with the main semi-supervised results. Strong disagreement between the fit types, or a significant improvement in fit quality when three or four clusters were used, permitted identification and removal of these aberrant probe sets.

2.4 Comparison to SNPscanner
We compared our ssG results to those of the supervised classifier, SNPscanner (Gresham et al., ). The purpose of this comparison was two fold. First, we were interested in exploring the extent to which SNPscanner's statistical model, trained on parental data, could predict the behavior of probes in a different genomic context. Second, we were interested in knowing which algorithm provided better genotyping data.

The SNPscanner algorithm was designed to work with arrays which only interrogate the reference genome (S288c). In addition, the SNPscanner algorithm uses loess-type (Cleveland, ) normalization instead of the experiment-wide VSN we used in Mancera et al. (), and was originally trained on a different array design. To facilitate comparison, we carried out a secondary ssG analysis using only S288c-specific probes, and following the SNPscanner normalization strategy. We retrained SNPscanner on our parental hybridization data, using only SNPs meeting its ‚Äòhigh-quality‚Äô criterion. We then used the so-trained model to genotype our segregant arrays, and passed results through the same SNPscanner quality filters used in Gresham et al. () (see Supplementary Methods). Filtered ssG and SNPscanner genotyping results were compared on the basis of call rate, concordance and accuracy.

3 RESULTS
Application of ssG to the data described in  permitted assessment of (i) the relationship between supervised and semi-supervised approaches to the genotyping task, (ii) the importance of quality filtering for genotyping accuracy and (iii) the differences between ssG and SNPscanner's model-based, supervised approach.

3.1 Parental versus offspring hybridizations
Probe set behavior in parental hybridizations‚Äîthe only source of training data available to a supervised classifier‚Äîwas often not representative of behavior in offspring hybridizations.  and  provide typical examples. In , parental distributions, while inaccurate, nonetheless lead to correct classification; in , however, a substantial fraction of offspring would be classified as S96 using the parental data but as YJM789 using the semi-supervised approach. Further, the parental data are better separated than the offspring, leading to an overly optimistic assessment of confidence in the probe set's genotype calls.

3.2 Filtering
One objective of Mancera et al. () was the characterization of short non-crossover gene conversion events. The number of putative small events seen in unfiltered ssG () or SNPscanner (data not shown) calls, however is far too large given our understanding of the biology. The ssG filters discussed in  removed most small events (). Importantly, these filters are based only on properties of the inferred distributions  and , not on event size; therefore, they are not biased against small events.
Typical genotype call behavior (30 segregants and 600 markers on chromosome IV). (A) Unfiltered ssG genotype calls include numerous putative single-marker genotype switches, as well as multi-marker regions with a large excess of one genotype. (B) Array-, polymorphism- and call-level filtering reduced marker density (by 30.5%), but also substantially reduced the error rate, as shown in . Most short events vanish, even though none of ssG's filters explicitly removes short events. (C) SNPscanner's heuristic filters discard substantially more calls (52.5%). Results are largely in agreement with those of ssG, but more putative short events remain. For two, identified in red, we examine probe behavior more closely in .


The effect of post-processing filters on concordance with 283 sequencing-confirmed genotype calls. Filters are applied sequentially; red numbers show calls passing applied filters. Group 1 is unfiltered data. Groups 2 and 3 use polymorphism-level filters based on, respectively, aberrant (three-class) behavior and excess distributional overlap. Groups 4 and 5 use call-level filters based on, respectively, proximity to decision boundary between classes and outlier status with respect to assigned class. Black plot corresponds to calls removed by the filters: accuracy here is near 50%, consistent with random guessing, suggesting that we are not over-filtering.


SNPscanner distributional estimates, projected into the first two PCs. (A) The YJM789 prediction does not correctly capture probe behavior for segregants with that genotype, although most apparent YJM789 segregants are closer to this distribution, and thus, are genotyped correctly. Sequencing confirmed that SNPscanner's call 1 in , shown here in orange, was in error. Because this call was intermediate to the two empirical distributions, it was dropped by ssG as error prone. (B) Call 2 in  corresponds to a locus which does not actually appear to be polymorphic.



As validation, sequencing-based genotype calls were obtained for 283 markers involved in or immediately adjacent to putative small events observed in the unfiltered ssG data (see Supplementary Methods).  shows that ‚âà10% of these unfiltered ssG calls were genotyping errors, but that the ssG filters removed all mistakes but one. As a second validation of our algorithm, array data for one wild-type tetrad were produced twice, in separate laboratories. Among the ‚âà163 000 genotype calls which passed ssG filters in both cases, one disagreement was found. The set of filtered calls, however, differed substantially: 23.8% of calls were made in one replicate but filtered in the other. Thus, ssG's filters were able to effectively adapt to varying array behavior.

3.3 Comparison to SNPscanner
When both ssG and SNPscanner employed their native filters, ssG made 45% more calls than SNPscanner, producing significantly denser effective marker coverage. A visual comparison of  and  shows, however, that ssG and SNPscanner typically made the same genotype call. Indeed, the methods only disagreed in 0.1% of the cases in which both made a genotype call. While this fraction is small, it constitutes thousands of potentially spurious short gene conversion events in our experiment‚Äîa number which would overwhelm the amount of true positive signal expected‚Äîor thousands false positives in the SNP discovery context.

Are the short events identified by SNPscanner in  correct?  shows SNPscanner's estimated distributions for two such events, circled in red in . In the first case, segregants formed two clusters, but YJM789 probe behavior did not match SNPscanner's prediction, and sequencing confirmed that SNPscanner's genotype call was in error. In fact, such discrepancies between SNPscanner's predictions and observed behavior were apparent for most probe sets. Often, segregants carrying the YJM789 allele produced data lying closer to the misplaced YJM789 estimate than to the S96 estimate, so SNPscanner made a correct genotype call. In other cases like , however, errors arose; and in all cases, one expects that polymorphism- and call-level filtering was negatively impacted by mis-estimation of the distributions. In the second circled example in , SNPscanner assigned nearly all tetrads the S96 genotype. , however, strongly suggest that this locus is not actually polymorphic. If so, then SNPscanner's calls are correct in a sense; accepting such calls at face value, however creates erroneous short events for segregants which have inherited YJM789 alleles in this region. ssG avoids this problem by applying a polymorphism-level filter which sets aside markers which fail to generate two well-separated distributions.

When applied to the replicated tetrad discussed in the previous section, ssG produced just one discrepant call across the four spores. SNPscanner, on the other hand, produced discrepancies for 13% of the markers at which it made a call in both replicates. SNPscanner's filters were also very sensitive to laboratory effect. When applied to the replicate hybridized in the same laboratory as its training data, SNPscanner filtered S96 and YJM789 calls in roughly equal proportion; when applied to the other replicate, however, it filtered out almost all S96 calls‚Äîmost likely due to a shift in distributional locations caused by the different conditions. Gresham et al. () suggest that, when using SNPscanner to genotype new samples, the training data provided by the authors are sufficient, i.e., that it is not necessary to retrain the model on locally produced training data. The observed sensitivity to laboratory effect for our replicated tetrad, however, suggests that this is not always the case.

3.4 Application: gene conversion
After filtering, it is straightforward to infer the crossover and gene conversion history for each tetrad, on each chromosome.  provides one example. In total, our analysis infers approximately 2126 observable, high-confidence gene conversion events and 4163 crossovers. A detailed analysis of these results and their implications for meiotic recombination is reported in Mancera et al. ().
Inferred recombination events for one tetrad, across chromosome II. Orange bars denote markers with a non-Mendelian ratio, arising from crossover-associated or non-crossover gene conversion. Zoomed regions shows that marker density is sufficient to capture genotype between the two Holliday junctions producing the crossover (see, e.g. de Massy, ). Note the unexpected region of apparent gene conversion on a third strand not involved in the crossover.



4 DISCUSSION AND CONCLUSION
Classification and clustering algorithms have traditionally been called supervised and unsupervised approaches, respectively. Supervised classification learns model parameters from labeled training data in one step, then attempts to assign labels to new data in a separate step. Unsupervised clustering, on the other hand, is not given labeled training data; instead, it attempts to divide unlabeled data into sensible groups in a single step.

In this article, we present the multivariate ssG algorithm. While many previously proposed array-based genotyping methods are supervised classifiers, ssG takes a semi-supervised approach: it clusters data by genotype in a single step, but in a way that takes advantage of the limited amount of labeled parental data. It is clear from  and  that parental hybridizations are not always representative, and that offspring intensity data contain a great deal of information about cluster membership and distributional shape. The semi-supervised approach exploits this information‚Äîinformation which is not available to a supervised classifier‚Äîand uses it to make more accurate distributional estimates and genotype calls.

We also contrast ssG with SNPscanner, a recently proposed supervised classifier which is also based on multivariate Gaussian mixtures. SNPscanner employs a parametric model to predict the impact of polymorphisms on probe behavior, while ssG uses no such model, relying instead on empirical distributions derived from the clusters it identifies. By using a probe behavior model, SNPscanner attempts to shift statistical testing from the asymmetric case (H0: Œ∏ = Œ∏0 vs. HA : Œ∏ ‚â† Œ∏0) to the simpler symmetric case (H0 : Œ∏ = Œ∏0 vs. HA : Œ∏ = Œ∏1). Such a shift is only possible if one can correctly specify Œ∏1. , however, shows that model-based specification is still not a realistic option. Indeed, models which accurately capture important quantities related to microarray probe behavior have remained elusive.

Our results have focused on genotyping in the context of meiotic recombination, but the ssG algorithm is immediately applicable to other contexts. It can be applied to individual probes as well as to probe sets, and can be used with other array designs‚Äîi.e. non-tiling arrays, or arrays which interrogate a single genome. Because sequence data were available for both strains considered in this study, it was natural to define probe sets on the basis of known polymorphisms. In general, sequence for the second strain is not required: probe sets may be defined simply on the basis of shared regions of interrogation. In such a case, most probe sets will interrogate non-polymorphic sequence and thus be uninformative, but standard model selection procedures (e.g. Bayesian information criterion (BIC)) appear to be sufficient for identification of sets which exhibit two-class behavior. As shown above, however, two-class behavior is necessary but not sufficient for effective genotyping: some probe sets corresponding to known polymorphisms do not clearly distinguish between the alleles; in other cases, varying genomic background and cross-hybridization may create two-class behavior even when there is no polymorphism at the interrogated locus.

Our results have important implications for the detection of polymorphisms in novel, unsequenced strains. Detection is typically accomplished by testing the null hypothesis that the novel strain's data have arisen from the same distribution seen in the reference strain. The discrepancies between parental and segregant behavior seen in , however, suggest that significant deviation may be observed even in the absence of polymorphism at the interrogated locus. If the novel and reference strains differ little genetically, use of the reference strain distribution is likely to be appropriate, provided that other sources of experimental variation have been appropriately controlled or normalized out. If, on the other hand, the novel strain is substantially diverged, naive comparisons to the reference strain distribution may run into serious false positive problems.

Supplementary Material
[Supplementary Data]
ACKNOWLEDGEMENTS
We thank contributors to the Bioconductor (www.bioconductor.org, Gentleman et al., )and R (www.R-project.org) projects for their software. We also thank Zhenyu Xu and Paul McGettigan for providing insight in the early stages of the project.

Funding: Deutsche Forschungsgemeinschaft; National Institutes of Health (to L.M.S.).

Conflict of Interest: none declared.

